{% extends "base.html" %}
{% from "partials/agent_activity.html" import render_activity_list %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem;">
    <h1 style="margin-bottom: 0;">Dashboard</h1>
    <form method="post" action="/editions" style="display: inline;">
        <button type="submit" class="btn btn-primary">New Edition</button>
    </form>
</div>

{% if active_edition %}
<div class="card" style="border-color: var(--accent-emphasis); margin-bottom: 1.25rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <div style="color: var(--text-muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.25rem;">Active Edition</div>
            <div style="font-size: 1.1rem; font-weight: 600;">{{ active_edition.content.get('title', 'Untitled') or 'Untitled' }}</div>
            <div style="display: flex; gap: 0.75rem; align-items: center; margin-top: 0.375rem;">
                <span class="badge badge-{{ active_edition.status }}">{{ active_edition.status }}</span>
                <span style="color: var(--text-muted); font-size: 0.8125rem;">{{ active_edition.link_ids | length }} links</span>
            </div>
        </div>
        <a href="/editions/{{ active_edition.id }}" class="btn btn-primary">Open Workspace →</a>
    </div>
</div>
{% endif %}

<div class="card">
    <h2 style="font-size: 1rem; margin-bottom: 0.75rem;">All Editions</h2>
    {% if editions %}
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Status</th>
                <th>Links</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            {% for edition in editions %}
            <tr style="cursor: pointer;" onclick="window.location='/editions/{{ edition.id }}'">
                <td><a href="/editions/{{ edition.id }}" style="color: var(--accent-emphasis); text-decoration: none;">{{ edition.content.get('title', 'Untitled') or 'Untitled' }}</a></td>
                <td><span class="badge badge-{{ edition.status }}">{{ edition.status }}</span></td>
                <td>{{ edition.link_ids | length }}</td>
                <td style="color: var(--text-muted);">{{ edition.created_at.strftime('%Y-%m-%d') if edition.created_at else '—' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: var(--text-muted);">No editions yet. Create one to get started.</p>
    {% endif %}
</div>

<div class="card" style="margin-top: 1rem;">
    <h2 style="font-size: 1rem; margin-bottom: 0.75rem;">Recent Agent Activity</h2>
    {{ render_activity_list(recent_runs) }}
</div>
{% endblock %}
